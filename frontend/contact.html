<nav>
  <div class="nav-items">
    <a href="/" class="nav-item">Home</a>
    <a href="/projects" class="nav-item">Projects</a>
    <a href="/skills" class="nav-item">Skills</a>
    <a href="/experience" class="nav-item">Experience</a>
    <a href="/blog" class="nav-item">Blog</a>
    <a href="/contact" class="nav-item">Contact</a>
  </div>
  <div class="latency" id="latency"></div>
</nav>

<section class="contact">
  <form id="contact-form">
    <div class="form-group">
      <label for="message">Message (PGP Encrypted)</label>
      <textarea id="message" required></textarea>
    </div>
    <button type="submit" class="cta">Send Secure Message</button>
  </form>
  <div class="server-status" id="server-status"></div>
</section>

<script>
  // API Needed: POST /api/contact
  document
    .getElementById("contact-form")
    .addEventListener("submit", async (e) => {
      e.preventDefault()
      const submitBtn = e.target.querySelector("button")
      submitBtn.disabled = true
      submitBtn.textContent = "Encrypting & Sending..."

      try {
        const token = await getCSRFToken()
        const response = await fetch("/api/contact", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRF-Token": token,
          },
          body: JSON.stringify({
            message: document.getElementById("message").value,
          }),
        })

        if (!response.ok) throw new Error("Server responded with error")

        showAlert("Message sent securely!", "success")
        document.getElementById("message").value = ""
      } catch (error) {
        showAlert(`Failed to send message: ${error.message}`, "error")
      } finally {
        submitBtn.disabled = false
        submitBtn.textContent = "Send Secure Message"
      }
    })

  async function showAlert(message, type = "info") {
    const alert = document.createElement("div")
    alert.className = `alert ${type}`
    alert.textContent = message
    document.body.appendChild(alert)

    setTimeout(() => alert.remove(), 5000)
  }
</script>
